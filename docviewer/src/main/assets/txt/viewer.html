<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>文本文件在线预览</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #fff;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 底部工具栏样式 */
        .bottom-toolbar {
            background: #eeeeee;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border-top: 1px solid #ddd;
            flex-shrink: 0;
        }

        .font-size-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .font-size-control span {
            color: #333;
            font-size: 14px;
        }

        .font-size-btn {
            background: #fff;
            border: 1px solid #ccc;
            color: #333;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .font-size-btn:hover {
            background: #f5f5f5;
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* 文本内容样式 */
        .text-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            background: #fff;
        }

        /* 加载状态 */
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #dc3545;
        }
    </style>
</head>

<body>
    <!-- 主内容区域 -->
    <div class="main-content">
        <!-- 文本内容 -->
        <div id="textContent" class="text-content loading">
            正在加载文件...
        </div>
    </div>

    <!-- 底部工具栏 -->
    <div class="bottom-toolbar">
        <div class="font-size-control">
            <span>字体大小:</span>
            <button class="font-size-btn" onclick="adjustFontSize(-1)">-</button>
            <button class="font-size-btn" onclick="adjustFontSize(1)">+</button>
            <button class="font-size-btn" onclick="resetFontSize()">重置</button>
        </div>
    </div>

    <script>
        /**
         * 简化文本预览器类
         * 负责处理txt文件的加载、显示和字体大小调整
         */
        class TextViewer {
            constructor() {
                // 初始化属性
                this.originalContent = '';
                this.currentFontSize = 14;
                
                // 获取DOM元素
                this.textContentEl = document.getElementById('textContent');
                
                // 初始化
                this.init();
            }

            /**
             * 初始化方法
             */
            init() {
                this.loadFile();
            }

            /**
             * 加载文件内容
             */
            loadFile() {
                try {
                    const params = new URLSearchParams(window.location.search);
                    const fileUrl = params.get("file");
                    
                    if (!fileUrl) {
                        throw new Error('未指定文件路径');
                    }

                    // 使用 XMLHttpRequest 代替 fetch，因为它在 Android WebView 中支持 file:// 协议
                    const xhr = new XMLHttpRequest();
                    
                    xhr.onload = () => {
                        if (xhr.status === 200 || xhr.status === 0) { // status 0 表示本地文件
                            this.displayContent(xhr.responseText, fileUrl);
                        } else {
                            this.showError(`文件加载失败: HTTP ${xhr.status}`);
                        }
                    };
                    
                    xhr.onerror = () => {
                        this.showError('文件加载失败: 网络错误或文件不存在');
                    };
                    
                    xhr.open('GET', fileUrl, true);
                    xhr.responseType = 'text';
                    xhr.send();
                    
                } catch (error) {
                    this.showError(`文件加载失败: ${error.message}`);
                }
            }

            /**
             * 显示文件内容
             */
            displayContent(content, fileUrl) {
                this.originalContent = content;
                this.textContentEl.textContent = content;
                this.textContentEl.className = 'text-content';
            }

            /**
             * 显示错误信息
             */
            showError(message) {
                this.textContentEl.innerHTML = `<div class="error">${message}</div>`;
            }



            /**
             * 调整字体大小
             */
            adjustFontSize(delta) {
                this.currentFontSize = Math.max(8, Math.min(32, this.currentFontSize + delta));
                this.textContentEl.style.fontSize = this.currentFontSize + 'px';
            }

            /**
             * 重置字体大小
             */
            resetFontSize() {
                this.currentFontSize = 14;
                this.textContentEl.style.fontSize = this.currentFontSize + 'px';
            }


        }

        // 全局实例
        let textViewer;

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            textViewer = new TextViewer();
        });

        // 全局函数（供HTML按钮调用）
        function adjustFontSize(delta) {
            textViewer.adjustFontSize(delta);
        }

        function resetFontSize() {
            textViewer.resetFontSize();
        }
    </script>
</body>

</html>
